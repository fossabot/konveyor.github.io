<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.105.0"><meta name=description content><link rel=icon href=/images/favicon.png type=image/png><title>Stateless application mirror - Documentation for Konveyor projects</title><link href=/css/nucleus.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet><link href=/css/hybrid.css rel=stylesheet><link href=/css/featherlight.min.css rel=stylesheet><link href=/css/perfect-scrollbar.min.css rel=stylesheet><link href=/css/auto-complete.css rel=stylesheet><link href=/css/atom-one-dark-reasonable.css rel=stylesheet><link href=/css/theme.css rel=stylesheet><link href=/css/tabs.css rel=stylesheet><link href=/css/hugo-theme.css rel=stylesheet><link href=/css/theme-konveyor.css rel=stylesheet><link href=/css/foo.css rel=stylesheet><link href=/css/bar.css rel=stylesheet><script src=/js/jquery-3.3.1.min.js></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style><script>var dataLayer=window.dataLayer=window.dataLayer||[];dataLayer.push({page:"Stateless application mirror",fileUniqID:"1fd4d8fe65b12c8a9a645f1dd574e32b"})</script><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-TKPDMS3")</script></head><body data-url=/crane/tutorials/statelessappmirror/><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href=/><img src=/images/konveyor_logo.png></img></a>
<a href=https://github.com/konveyor/konveyor.github.io>Documentation source code</a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js></script>
<script type=text/javascript src=/js/auto-complete.js></script>
<script type=text/javascript>var baseurl="http://konveyor.github.io/"</script><script type=text/javascript src=/js/search.js></script></div><div class=highlightable><ul class=topics><li data-nav-id=/crane/ title=Crane class="dd-item
parent"><a href=/crane/><b>1 </b>Crane</a><ul><li data-nav-id=/crane/overview/ title=Overview class=dd-item><a href=/crane/overview/>Overview</a></li><li data-nav-id=/crane/tutorials/ title=Tutorials class="dd-item
parent"><a href=/crane/tutorials/>Tutorials</a><ul><li data-nav-id=/crane/tutorials/statelessappmirror/ title="Stateless application mirror" class="dd-item active"><a href=/crane/tutorials/statelessappmirror/>Stateless application mirror</a></li><li data-nav-id=/crane/tutorials/migratek8cluster/ title="Migrating a Kubernetes cluster" class=dd-item><a href=/crane/tutorials/migratek8cluster/>Migrating a Kubernetes cluster</a></li></ul></li><li data-nav-id=/crane/tools/ title=Tools class=dd-item><a href=/crane/tools/>Tools</a><ul><li data-nav-id=/crane/tools/gitopsintegration/ title="Integrating GitOps" class=dd-item><a href=/crane/tools/gitopsintegration/>Integrating GitOps</a></li><li data-nav-id=/crane/tools/customplugins/ title="Developing custom plugins" class=dd-item><a href=/crane/tools/customplugins/>Developing custom plugins</a></li><li data-nav-id=/crane/tools/tunnelapi/ title="Tunnel API" class=dd-item><a href=/crane/tools/tunnelapi/>Tunnel API</a></li><li data-nav-id=/crane/tools/pluginmanager/ title="Plugin Manager" class=dd-item><a href=/crane/tools/pluginmanager/>Plugin Manager</a></li></ul></li><li data-nav-id=/crane/usingcrane/ title="Using Crane" class=dd-item><a href=/crane/usingcrane/>Using Crane</a><ul><li data-nav-id=/crane/usingcrane/step1export/ title="Step One: Export Resources" class=dd-item><a href=/crane/usingcrane/step1export/>Step One: Export Resources</a></li><li data-nav-id=/crane/usingcrane/step2transform/ title="Step Two: Transform Exports" class=dd-item><a href=/crane/usingcrane/step2transform/>Step Two: Transform Exports</a></li><li data-nav-id=/crane/usingcrane/step3apply/ title="Step Three: Apply Patches" class=dd-item><a href=/crane/usingcrane/step3apply/>Step Three: Apply Patches</a></li></ul></li><li data-nav-id=/crane/installation/ title="Installing Crane" class=dd-item><a href=/crane/installation/>Installing Crane</a></li></ul></li><li data-nav-id=/forklift/ title=Forklift class=dd-item><a href=/forklift/><b>2 </b>Forklift</a><ul><li data-nav-id=/forklift/overview/ title=Overview class=dd-item><a href=/forklift/overview/>Overview</a></li><li data-nav-id=/forklift/migratingvms/ title="Migrating virtual machines" class=dd-item><a href=/forklift/migratingvms/>Migrating virtual machines</a><ul><li data-nav-id=/forklift/migratingvms/migrateoptions/ title="Migration plan options" class=dd-item><a href=/forklift/migratingvms/migrateoptions/>Migration plan options</a></li><li data-nav-id=/forklift/migratingvms/migratecli/ title="Migrating virtual machines using the command line" class=dd-item><a href=/forklift/migratingvms/migratecli/>Migrating virtual machines using the command line</a></li><li data-nav-id=/forklift/migratingvms/migrateweb/ title="Migrating virtual machines using the web console" class=dd-item><a href=/forklift/migratingvms/migrateweb/>Migrating virtual machines using the web console</a></li><li data-nav-id=/forklift/migratingvms/cancelmigrate/ title="Canceling a migration" class=dd-item><a href=/forklift/migratingvms/cancelmigrate/>Canceling a migration</a></li><li data-nav-id=/forklift/migratingvms/advancedmigrate/ title="Advanced migration options" class=dd-item><a href=/forklift/migratingvms/advancedmigrate/>Advanced migration options</a></li></ul></li><li data-nav-id=/forklift/installingforklift/ title="Installing Forklift" class=dd-item><a href=/forklift/installingforklift/>Installing Forklift</a><ul><li data-nav-id=/forklift/installingforklift/upgrade/ title="Upgrading Forklift" class=dd-item><a href=/forklift/installingforklift/upgrade/>Upgrading Forklift</a></li><li data-nav-id=/forklift/installingforklift/uninstall/ title="Uninstalling Forklift" class=dd-item><a href=/forklift/installingforklift/uninstall/>Uninstalling Forklift</a></li><li data-nav-id=/forklift/installingforklift/installation/ title="Installing the Forklift Operator" class=dd-item><a href=/forklift/installingforklift/installation/>Installing the Forklift Operator</a></li><li data-nav-id=/forklift/installingforklift/prereqs/ title=Prerequisites class=dd-item><a href=/forklift/installingforklift/prereqs/>Prerequisites</a></li></ul></li></ul></li><li data-nav-id=/move2kube/ title=Move2Kube class=dd-item><a href=/move2kube/><b>3 </b>Move2Kube</a><ul><li data-nav-id=/move2kube/overview/ title=Overview class=dd-item><a href=/move2kube/overview/>Overview</a></li><li data-nav-id=/move2kube/concepts/ title=Concepts class=dd-item><a href=/move2kube/concepts/>Concepts</a></li><li data-nav-id=/move2kube/installation/ title=Installation class=dd-item><a href=/move2kube/installation/>Installation</a><ul><li data-nav-id=/move2kube/installation/installweb/ title="Web Interface" class=dd-item><a href=/move2kube/installation/installweb/>Web Interface</a></li><li data-nav-id=/move2kube/installation/installcli/ title="Command line tool" class=dd-item><a href=/move2kube/installation/installcli/>Command line tool</a></li></ul></li><li data-nav-id=/move2kube/commands/ title=Commands class=dd-item><a href=/move2kube/commands/>Commands</a></li><li data-nav-id=/move2kube/transformers/ title=Transformers class=dd-item><a href=/move2kube/transformers/>Transformers</a></li><li data-nav-id=/move2kube/tutorials/ title=Tutorials class=dd-item><a href=/move2kube/tutorials/>Tutorials</a><ul><li data-nav-id=/move2kube/tutorials/usingcli/ title="Using Move2Kube CLI" class=dd-item><a href=/move2kube/tutorials/usingcli/>Using Move2Kube CLI</a></li><li data-nav-id=/move2kube/tutorials/usingui/ title="Using Move2Kube UI" class=dd-item><a href=/move2kube/tutorials/usingui/>Using Move2Kube UI</a></li><li data-nav-id=/move2kube/tutorials/cfappstok8/ title="Migrating Enterprise Scale Cloud Foundry Apps to Kubernetes" class=dd-item><a href=/move2kube/tutorials/cfappstok8/>Migrating Enterprise Scale Cloud Foundry Apps to Kubernetes</a><ul><li data-nav-id=/move2kube/tutorials/cfappstok8/1collect/ title="1. Collect" class=dd-item><a href=/move2kube/tutorials/cfappstok8/1collect/>1. Collect</a></li><li data-nav-id=/move2kube/tutorials/cfappstok8/2plan/ title="2. Plan" class=dd-item><a href=/move2kube/tutorials/cfappstok8/2plan/>2. Plan</a></li><li data-nav-id=/move2kube/tutorials/cfappstok8/3transform/ title="3. Transform" class=dd-item><a href=/move2kube/tutorials/cfappstok8/3transform/>3. Transform</a></li></ul></li><li data-nav-id=/move2kube/tutorials/customizeoutput/ title="Customizing the output" class=dd-item><a href=/move2kube/tutorials/customizeoutput/>Customizing the output</a><ul><li data-nav-id=/move2kube/tutorials/customizeoutput/addcustfiledir/ title="Add custom files and directories in custom locations" class=dd-item><a href=/move2kube/tutorials/customizeoutput/addcustfiledir/>Add custom files and directories in custom locations</a></li><li data-nav-id=/move2kube/tutorials/customizeoutput/paramcustomfieldshelm/ title="Parameterizing custom fields in Helm Chart, Kustomize, OC templates" class=dd-item><a href=/move2kube/tutorials/customizeoutput/paramcustomfieldshelm/>Parameterizing custom fields in Helm Chart, Kustomize, OC templates</a></li><li data-nav-id=/move2kube/tutorials/customizeoutput/customannotationsyaml/ title="Add custom annotations to Kubernetes YAMLs" class=dd-item><a href=/move2kube/tutorials/customizeoutput/customannotationsyaml/>Add custom annotations to Kubernetes YAMLs</a></li><li data-nav-id=/move2kube/tutorials/customizeoutput/customgendockerfile/ title="Customize generated Dockerfile and built-in transformer behavior" class=dd-item><a href=/move2kube/tutorials/customizeoutput/customgendockerfile/>Customize generated Dockerfile and built-in transformer behavior</a></li></ul></li><li data-nav-id=/move2kube/tutorials/customkubeyaml/ title="Customize Kubernetes YAMLs to target specific clusters" class=dd-item><a href=/move2kube/tutorials/customkubeyaml/>Customize Kubernetes YAMLs to target specific clusters</a></li><li data-nav-id=/move2kube/tutorials/createhelmchartskustomize/ title="Create Helm-charts, Kustomize overlays from Kubernetes Yamls" class=dd-item><a href=/move2kube/tutorials/createhelmchartskustomize/>Create Helm-charts, Kustomize overlays from Kubernetes Yamls</a></li><li data-nav-id=/move2kube/tutorials/createwincontainersnet/ title="Create and deploy Windows .NET containers" class=dd-item><a href=/move2kube/tutorials/createwincontainersnet/>Create and deploy Windows .NET containers</a></li><li data-nav-id=/move2kube/tutorials/migratedeploynetcore/ title="Migrate and deploy .NET Core applications to Kubernetes" class=dd-item><a href=/move2kube/tutorials/migratedeploynetcore/>Migrate and deploy .NET Core applications to Kubernetes</a></li><li data-nav-id=/move2kube/tutorials/migratedockercomposekube/ title="Migrate from Docker Compose to Kubernetes" class=dd-item><a href=/move2kube/tutorials/migratedockercomposekube/>Migrate from Docker Compose to Kubernetes</a></li><li data-nav-id=/move2kube/tutorials/migratedeploycfapps/ title="Migrate and deploy Cloud Foundry applications to Kubernetes" class=dd-item><a href=/move2kube/tutorials/migratedeploycfapps/>Migrate and deploy Cloud Foundry applications to Kubernetes</a></li><li data-nav-id=/move2kube/tutorials/runnoninteractively/ title="Run transforms non-interactively" class=dd-item><a href=/move2kube/tutorials/runnoninteractively/>Run transforms non-interactively</a></li></ul></li></ul></li><li data-nav-id=/tackle/ title="Tackle 1.0 & 2.0" class=dd-item><a href=/tackle/><b>4 </b>Tackle 1.0 & 2.0</a><ul><li data-nav-id=/tackle/tackle1/ title="Tackle 1.0" class=dd-item><a href=/tackle/tackle1/><b>4.1 </b>Tackle 1.0</a><ul><li data-nav-id=/tackle/tackle1/upgrade/ title="Upgrading Tackle" class=dd-item><a href=/tackle/tackle1/upgrade/>Upgrading Tackle</a></li><li data-nav-id=/tackle/tackle1/webconsolesvcs/ title="Web Console Services" class=dd-item><a href=/tackle/tackle1/webconsolesvcs/>Web Console Services</a></li><li data-nav-id=/tackle/tackle1/manageusers/ title="Managing users and credentials" class=dd-item><a href=/tackle/tackle1/manageusers/>Managing users and credentials</a></li><li data-nav-id=/tackle/tackle1/manageassess/ title="Managing assessments" class=dd-item><a href=/tackle/tackle1/manageassess/>Managing assessments</a></li><li data-nav-id=/tackle/tackle1/manageapps/ title="Managing applications" class=dd-item><a href=/tackle/tackle1/manageapps/>Managing applications</a></li><li data-nav-id=/tackle/tackle1/additionaltools/ title="Additional tools" class=dd-item><a href=/tackle/tackle1/additionaltools/>Additional tools</a></li></ul></li><li data-nav-id=/tackle/tackle2/ title="Tackle 2.0" class=dd-item><a href=/tackle/tackle2/><b>4.2 </b>Tackle 2.0</a><ul><li data-nav-id=/tackle/tackle2/admintasks/ title="Administrator view tasks" class=dd-item><a href=/tackle/tackle2/admintasks/>Administrator view tasks</a></li><li data-nav-id=/tackle/tackle2/views/ title="Tackle 2.0 Views" class=dd-item><a href=/tackle/tackle2/views/>Tackle 2.0 Views</a></li><li data-nav-id=/tackle/tackle2/instances/ title="Seeding Instances" class=dd-item><a href=/tackle/tackle2/instances/>Seeding Instances</a></li><li data-nav-id=/tackle/tackle2/assessanalyze/ title="Assessing and analyzing applications" class=dd-item><a href=/tackle/tackle2/assessanalyze/>Assessing and analyzing applications</a></li><li data-nav-id=/tackle/tackle2/addapps/ title="Adding applications" class=dd-item><a href=/tackle/tackle2/addapps/>Adding applications</a></li></ul></li><li data-nav-id=/tackle/overview/ title=Overview class=dd-item><a href=/tackle/overview/>Overview</a></li><li data-nav-id=/tackle/upgradeto2/ title="Upgrading from 1.2 to 2.0" class=dd-item><a href=/tackle/upgradeto2/>Upgrading from 1.2 to 2.0</a></li><li data-nav-id=/tackle/installation/ title="Installing Tackle 2.0" class=dd-item><a href=/tackle/installation/>Installing Tackle 2.0</a></li><li data-nav-id=/tackle/installation1/ title="Installing Tackle 1.0" class=dd-item><a href=/tackle/installation1/>Installing Tackle 1.0</a></li></ul></li></ul><section id=footer><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a> from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links>Stateless application mirror</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#1-deploy-the-guestbook-application-in-the-source-cluster>1. Deploy the Guestbook application in the source cluster</a></li><li><a href=#2-extract-from-the-source-cluster>2. Extract from the source cluster</a></li><li><a href=#3-generate-transformations>3. Generate Transformations</a></li><li><a href=#4-apply-transformations>4. Apply Transformations</a><ul><li><a href=#apply-the-manifests-to-the-destination-cluster>Apply the manifests to the destination cluster</a></li></ul></li><li><a href=#next-steps>Next Steps</a></li><li><a href=#cleanup>Cleanup</a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Stateless application mirror</h1><p>This tutorial is an example of how to mirror a simple, stateless <a href=https://kubernetes.io/docs/tutorials/stateless-application/guestbook/>PHP Guestbook application</a> using Crane.</p><p><strong>Roadmap</strong></p><ul><li><strong>1. Deploy</strong> the Guestbook application in the source cluster.</li><li><strong>2. Extract</strong> resources from the source cluster using Crane Export.</li><li><strong>3. Transform</strong> resources to prepare manifests for the destination cluster using Crane Transform.</li><li><strong>4. Apply</strong> the transformations using Crane Apply.<ul><li>Apply application manifests to the destination cluster.</li></ul></li></ul><p><strong>Prerequisites</strong></p><ol><li>Create a source and destination Kubernetes cluster environment in minikube or Kind:</li></ol><p><strong>minikube</strong></p><pre tabindex=0><code>wget &#34;https://raw.githubusercontent.com/konveyor/crane/main/hack/minikube-clusters-start.sh&#34;
chmod +x minikube-clusters-start.sh./minikube-clusters-start.sh
</code></pre><p><strong>Kind</strong></p><pre tabindex=0><code>wget &#34;https://raw.githubusercontent.com/konveyor/crane-runner/main/hack/kind-up.sh&#34;
chmod +x kind-up.sh./kind-up.sh
</code></pre><ol start=2><li>Install Crane using the <a href=https://crane-docs.konveyor.io/content/getting-started/installation/>Installation Guide</a>.</li></ol><blockquote><p><strong>Important:</strong> Read through <a href=https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/>Kubernetes&rsquo; documentation on accessing multiple clusters</a>. This document references <strong>src</strong> and <strong>dest</strong> contexts that refer to the clusters created using the minikube startup scripts above.</p></blockquote><p>When working in the home environment, or use kind (<code>kind-src</code> and <code>kind-dest</code>), modify the commands below to reference the correct cluster context.</p><h2 id=1-deploy-the-guestbook-application-in-the-source-cluster>1. Deploy the Guestbook application in the source cluster</h2><p>Deploy the <a href=https://kubernetes.io/docs/tutorials/stateless-application/guestbook/>Kubernetes&rsquo; stateless guestbook application</a> and modify it to be consumable with <a href=https://kustomize.io/>Kustomize</a> (Kubernetes native and template-free tool to manage application configuration). The guestbook application consists of:</p><ul><li>redis leader deployment and service</li><li>redis follower deployment and service</li><li>guestbook front-end deployment and service</li></ul><pre tabindex=0><code>kubectl --context src create namespace guestbook
kubectl --context src --namespace guestbook apply -k github.com/konveyor/crane-runner/examples/resources/guestbook
kubectl --context src --namespace guestbook wait --for=condition=ready pod --selector=app=guestbook --timeout=180s
</code></pre><p><strong>Optional</strong></p><p>Forward localhost traffic to the frontend of the Guestbook application to access Guestbook from a browser using <code>localhost:8080</code>:</p><pre tabindex=0><code>kubectl --context src --namespace guestbook port-forward svc/frontend 8080:80
</code></pre><h2 id=2-extract-from-the-source-cluster>2. Extract from the source cluster</h2><p>Crane’s <code>export</code> command extracts all of the specified resources from the “source” cluster.</p><pre tabindex=0><code>crane export --context src --namespace guestbook
</code></pre><p>Check the <code>export</code> directory to verify it is working correctly. The directory should look similar to the example below:</p><pre tabindex=0><code>$ tree -a export
export
├── failures
│   └── guestbook
└── resources
    └── guestbook
        ├── ConfigMap_guestbook_kube-root-ca.crt.yaml
        ├── Deployment_guestbook_frontend.yaml
        ├── Deployment_guestbook_redis-master.yaml
        ├── Deployment_guestbook_redis-slave.yaml
        ├── Endpoints_guestbook_frontend.yaml
        ├── Endpoints_guestbook_redis-master.yaml
        ├── Endpoints_guestbook_redis-slave.yaml
        ├── EndpointSlice_guestbook_frontend-bkqbs.yaml
        ├── EndpointSlice_guestbook_redis-master-hxr5k.yaml
        ├── EndpointSlice_guestbook_redis-slave-8wt7z.yaml
        ├── Pod_guestbook_frontend-5fd859dcf6-5nvbm.yaml
        ├── Pod_guestbook_frontend-5fd859dcf6-j8w94.yaml
        ├── Pod_guestbook_frontend-5fd859dcf6-s9x8p.yaml
        ├── Pod_guestbook_redis-master-55d9747c6c-6f9bz.yaml
        ├── Pod_guestbook_redis-slave-5c6b4c5b47-jnrsr.yaml
        ├── Pod_guestbook_redis-slave-5c6b4c5b47-xz776.yaml
        ├── ReplicaSet_guestbook_frontend-5fd859dcf6.yaml
        ├── ReplicaSet_guestbook_redis-master-55d9747c6c.yaml
        ├── ReplicaSet_guestbook_redis-slave-5c6b4c5b47.yaml
        ├── Secret_guestbook_default-token-5vsrb.yaml
        ├── ServiceAccount_guestbook_default.yaml
        ├── Service_guestbook_frontend.yaml
        ├── Service_guestbook_redis-master.yaml
        └── Service_guestbook_redis-slave.yaml

4 directories, 24 files
</code></pre><p>Crane Export is using a discovery client to see all of the API resources in the specified namespace of the designated cluster and outputing them to the disk in YAML form. This allows workloads to migrate in a non-destructive way.</p><p>Going forward these manifests will be working on the disk without impacting the active resources in the “source” cluster.</p><h2 id=3-generate-transformations>3. Generate Transformations</h2><p>Crane’s <code>transform</code> command generates tranformations in the form of JSON patches and stores them on the disk in the transform directory (unless overridden using <code>--transform-dir</code>).</p><pre tabindex=0><code>crane transform
</code></pre><p>Check the transform directory to verify the command worked correctly:</p><pre tabindex=0><code>$ tree -a transform
</code></pre><p>The directory should look similar to the example below:</p><pre tabindex=0><code>transform
└── resources
    └── guestbook
        ├── transform-ConfigMap_guestbook_kube-root-ca.crt.yaml
        ├── transform-Deployment_guestbook_frontend.yaml
        ├── transform-Deployment_guestbook_redis-master.yaml
        ├── transform-Deployment_guestbook_redis-slave.yaml
        ├── transform-Secret_guestbook_default-token-5vsrb.yaml
        ├── transform-ServiceAccount_guestbook_default.yaml
        ├── transform-Service_guestbook_frontend.yaml
        ├── transform-Service_guestbook_redis-master.yaml
        ├── transform-Service_guestbook_redis-slave.yaml
        ├── .wh.Endpoints_guestbook_frontend.yaml
        ├── .wh.Endpoints_guestbook_redis-master.yaml
        ├── .wh.Endpoints_guestbook_redis-slave.yaml
        ├── .wh.EndpointSlice_guestbook_frontend-bkqbs.yaml
        ├── .wh.EndpointSlice_guestbook_redis-master-hxr5k.yaml
        ├── .wh.EndpointSlice_guestbook_redis-slave-8wt7z.yaml
        ├── .wh.Pod_guestbook_frontend-5fd859dcf6-5nvbm.yaml
        ├── .wh.Pod_guestbook_frontend-5fd859dcf6-j8w94.yaml
        ├── .wh.Pod_guestbook_frontend-5fd859dcf6-s9x8p.yaml
        ├── .wh.Pod_guestbook_redis-master-55d9747c6c-6f9bz.yaml
        ├── .wh.Pod_guestbook_redis-slave-5c6b4c5b47-jnrsr.yaml
        ├── .wh.Pod_guestbook_redis-slave-5c6b4c5b47-xz776.yaml
        ├── .wh.ReplicaSet_guestbook_frontend-5fd859dcf6.yaml
        ├── .wh.ReplicaSet_guestbook_redis-master-55d9747c6c.yaml
        └── .wh.ReplicaSet_guestbook_redis-slave-5c6b4c5b47.yaml

2 directories, 24 files
</code></pre><p>Crane Transform is iterating through the configured plugins and running them against the exported resources from the previous step. View which plugins are configured with Crane Transform list-plugins and optional arguments to those plugins with crane transform optionals.</p><p>Explore what plugins can be configured with the Crane plugin-manager list, install one, and customize the exported resources:</p><pre tabindex=0><code>crane transform --optional-flags=&#34;add-annotations=custom-crane-annotation=foo&#34;
</code></pre><p>If the flags get difficult to manage via the command-line, specify a <code>--flags-file</code> similar to the example below::</p><pre tabindex=0><code>debug: false
export-dir: myExport
transform-dir: myTransform
output-dir: myOutput
optional-flags:
  add-annotations:
    custom-crane-annotation: &#34;foo&#34;
</code></pre><h2 id=4-apply-transformations>4. Apply Transformations</h2><p>The Crane Apply command takes the exported resources and transformations and renders the results as YAML files that can be applied to another cluster.</p><pre tabindex=0><code>crane apply
</code></pre><p>Look at one of the transformations created in the last step to better understand the Apply command.</p><pre tabindex=0><code>$ cat transform/resources/guestbook/transform-Deployment_guestbook_frontend.yaml
[{&#34;op&#34;:&#34;remove&#34;,&#34;path&#34;:&#34;/metadata/uid&#34;},{&#34;op&#34;:&#34;remove&#34;,&#34;path&#34;:&#34;/metadata/resourceVersion&#34;},{&#34;op&#34;:&#34;remove&#34;,&#34;path&#34;:&#34;/metadata/creationTimestamp&#34;},{&#34;op&#34;:&#34;remove&#34;,&#34;path&#34;:&#34;/metadata/generation&#34;},{&#34;op&#34;:&#34;remove&#34;,&#34;path&#34;:&#34;/status&#34;}]%
</code></pre><p>When crane applies the transformations for the Guestbook frontend it executes a handful of JSON patches that:</p><ul><li>Remove the UID</li><li>Remove the resourceVersion</li><li>Remove the creationTimestamp</li><li>Remove the generation field</li><li>Remove the status</li></ul><p>The leftover data from the source cluster is removed from the final manifests to make them applicable to the destination cluster.</p><p>The resources are effectively cluster agnostic and ready to be kubectl applied to the chosen cluster or placed under version control to be later managed by GitOps and CI/CD pipelines.</p><blockquote><p><strong>Note:</strong> Additional patches to add/remove/replace additional fields on the resources previously exported are available if optional flags are specified..</p></blockquote><h3 id=apply-the-manifests-to-the-destination-cluster>Apply the manifests to the destination cluster</h3><p>Apply the manifests prepared for the destination cluster using <code>kubectl</code> directly:</p><pre tabindex=0><code>kubectl --context dest create namespace guestbook
kubectl --context dest --namespace guestbook --recursive=true apply -f ./output
</code></pre><blockquote><p><strong>Note:</strong> To change the namespace, use <a href=https://kustomize.io/>Kustomize</a>.</p></blockquote><pre tabindex=0><code>cd output/resources/guestbook
kustomize init --namespace custom-guestbook --autodetect
</code></pre><p>The result is a kustomization.yaml like the example below:</p><pre tabindex=0><code>apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- ConfigMap_guestbook_kube-root-ca.crt.yaml
- Deployment_guestbook_frontend.yaml
- Deployment_guestbook_redis-master.yaml
- Deployment_guestbook_redis-slave.yaml
- Secret_guestbook_default-token-5vsrb.yaml
- ServiceAccount_guestbook_default.yaml
- Service_guestbook_frontend.yaml
- Service_guestbook_redis-master.yaml
- Service_guestbook_redis-slave.yaml
namespace: custom-guestbook
</code></pre><p>After creating the custom-guestbook namespace, apply the kustomization.yaml with <code>kubectl apply -k</code>.</p><h2 id=next-steps>Next Steps</h2><ul><li>Read more about Crane.</li><li>Check out Crane Runner to perform application migrations inside Kubernetes.</li></ul><h2 id=cleanup>Cleanup</h2><pre tabindex=0><code>kubectl --context dest delete namespace guestbook
</code></pre><p><a href=https://github.com/konveyor/konveyor.github.io/blob/main/content/Crane/Tutorials/StatelessAppMirror.md>Source</a></p><footer class=footline></footer></div></div><div id=navigation></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js></script>
<script src=/js/perfect-scrollbar.min.js></script>
<script src=/js/perfect-scrollbar.jquery.min.js></script>
<script src=/js/jquery.sticky.js></script>
<script src=/js/featherlight.min.js></script>
<script src=/js/highlight.pack.js></script>
<script>hljs.initHighlightingOnLoad()</script><script src=/js/modernizr.custom-3.6.0.js></script>
<script src=/js/learn.js></script>
<script src=/js/hugo-learn.js></script>
<script src=https://unpkg.com/mermaid@8.8.0/dist/mermaid.min.js></script>
<script>mermaid.initialize({startOnLoad:!0})</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TKPDMS3" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript></body></html>